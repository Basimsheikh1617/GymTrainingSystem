@{
    ViewData["Title"] = "Members List";
}

<style>
    div.dt-container {
        position: relative;
        clear: both;
        overflow: auto;
    }

    body {
        background-color: transparent !important;
        margin: 0;
        /* overflow-x: hidden; */
    }

    /* Custom styles to make DataTable look more professional and modern */
    #membersTable {
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Modern font */
    }

        #membersTable thead th {
            background-color: #343a40; /* Dark header background to match professional themes (e.g., dark blue/gray) */
            color: #ffffff; /* White text for contrast */
            text-align: left;
            padding: 12px 15px;
            border-bottom: 2px solid #dee2e6; /* Subtle border */
            font-weight: 600;
        }

        #membersTable tbody tr {
            transition: background-color 0.2s ease; /* Smooth hover effect */
        }

            #membersTable tbody tr:hover {
                background-color: #f1f1f1; /* Light hover for interaction feedback */
            }

        #membersTable tbody td {
            padding: 10px 15px;
            border-top: 1px solid #dee2e6; /* Light borders */
        }

        /* Style for search inputs in the second header row */
        #membersTable thead tr:eq(1) th input {
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 0.875rem;
            width: 100%;
            box-sizing: border-box;
        }

    /* DataTables controls (pagination, buttons, etc.) */
    .dt-buttons .btn {
        border-radius: 4px;
        margin-right: 5px;
        font-size: 0.875rem;
        padding: 6px 12px;
    }

    .dataTables_paginate .paginate_button {
        border-radius: 4px;
        margin: 0 2px;
    }

    .dataTables_length select,
    .dataTables_filter input {
        border-radius: 4px;
        border: 1px solid #ced4da;
        padding: 6px 10px;
    }

    table.table.dataTable.table-striped > tbody > tr:nth-of-type(2n+1) > * {
        box-shadow: none !important;
    }
    /* Ensure responsive design looks clean */
    @@media (max-width: 768px) {
        #membersTable

    {
        font-size: 0.875rem;
    }

    }
</style>

<table id="membersTable" class="table table-striped table-bordered display" style="width:100%">
    <thead>
        <tr></tr> <!-- Placeholder for dynamic headers -->
    </thead>
</table>

@section Scripts {
    <!-- DataTables Bootstrap 5 integration -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.bootstrap5.min.css" />

    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.min.js"></script>

    <!-- DataTables Buttons for export features -->
    <script src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.colVis.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script> <!-- For Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script> <!-- For PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script> <!-- For PDF fonts -->

    <script>
        $(document).ready(function () {
            $.ajax({
                url: '@Url.Action("Get_Member", "Member")',
                type: 'POST',
                success: function (response) {
                    // Parse the returned JSON (DataTables expects real JSON)
                    var data = response.data;
                    console.log(data);
                    if (!data || data.length === 0) {
                        $('#membersTable').html("<tr><td>No members found</td></tr>");
                        return;
                    }

                    // Dynamically create columns based on the first row's keys
                    var dateColumns = ['JoiningDate', 'MemberShipStart', 'MemberShipEnd']; // Add more if needed
                    var columns = Object.keys(data[0]).map(key => ({
                        data: key,
                        title: key.charAt(0).toUpperCase() + key.slice(1), // Capitalize titles
                        render: dateColumns.includes(key) ? function(data, type, row) {
                            if (data && data.includes('T')) {
                                return data.split('T')[0]; // Extract only the date part
                            }
                            return data || ''; // Return as is if no time or empty
                        } : null
                    }));

                    // Initialize DataTable dynamically
                    var table = $('#membersTable').DataTable({
                        data: data,
                        columns: columns,
                        pageLength: 10,
                        responsive: true,
                        dom: 'lBfrtip', // l for length menu, B for buttons, f for filter, r for processing, t for table, i for info, p for pagination
                        buttons: [
                            'colvis', // Column visibility first
                            'copy',   // Copy to clipboard
                            'csv',    // CSV export
                            'excel',  // Excel export
                            'pdf',    // PDF export
                            'print'   // Print
                        ],
                        orderCellsTop: true, // Sorting on top header row
                        fixedHeader: false,
                        language: {
                            search: "Search all columns:", // More professional search label
                            lengthMenu: "Show _MENU_ entries", // Customized menu text
                            info: "Showing _START_ to _END_ of _TOTAL_ entries" // Info text
                        }
                    });

                    // Add second header row for per-column searches to match the image
                    $('#membersTable thead tr').clone(true).appendTo('#membersTable thead');
                    $('#membersTable thead tr:eq(1) th').each(function (i) {
                        var title = $(this).text();
                        $(this).html('<input type="text" placeholder="Search ' + title + '" style="width:100%;" />');

                        $('input', this).on('keyup change clear', function () {
                            if (table.column(i).search() !== this.value) {
                                table.column(i).search(this.value).draw();
                            }
                        });
                    });

                    // Disable sorting on the search input row
                    $('#membersTable thead tr:eq(1) th').removeClass('sorting sorting_asc sorting_desc');
                },
                error: function (xhr, status, error) {
                    console.error("Error loading members:", error);
                }
            });
        });
    </script>
}

